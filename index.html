<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://unpkg.com/es-module-shims@1.7.1/dist/es-module-shims.js"></script>
    <script src="https://unpkg.com/aframe@1.0.4/dist/aframe-v1.0.4.min.js"></script>
    <script src="https://unpkg.com/ar.js@2.2.2/aframe/build/aframe-ar.min.js"></script>
    <script src="https://unpkg.com/reconnecting-websocket@4.4.0/dist/reconnecting-websocket-iife.min.js"></script>

    <script type="module">
            import { createApp, reactive } from "https://unpkg.com/petite-vue?module";
            const pol2car = (a, r) => {
              return {
                x: Math.cos((a - 90) * (Math.PI / 180)) * r,
                y: Math.sin((a - 90) * (Math.PI / 180)) * r,
              };
            };
            const random = (from = 0, to = 1) => from + Math.random() * (to - from);
            const randomInt = (min = 0, max = 1) => Math.floor(random(min, max)
      }
            const range = (from, to, step = 1) => {
              const length = Math.floor((to - from) / step) + 1;
              return Array.from({ length }).map((_, i) => from + i * step);
            };
            const data = reactive({ z: -10, message: "Hello" });
            createApp({ data, range }).mount();

            const socket = new WebSocket("wss://data.elektron.art");
            socket.addEventListener("message", (event) => {
              const message = JSON.parse(event.data);
              if (message.channel == "amfr") {
                data.message = message.value;
              }
            });
    </script>
  </head>

  <body style="margin: 0; overflow: hidden">
    <a-scene
      vr-mode-ui="enabled: false"
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false;"
    >
      <a-entity v-for="a in range(-5,5)" :rotation="{x: 0, y: a * 10, z: 0 }">
        <a-entity :position="{x: 0, y: 1.5, z: data.z }">
          <a-entity
            material="color: black; opacity: 0.5;"
            geometry="primitive: box; depth: 0.1; width: 2; height: 2"
            position="0 0 0"
            opacity="0.5"
          >
          </a-entity>
          <a-entity
            position="1.75 0.7 1"
            :text="{width: 5, lineHeight: 50, color: 'white', value: data.message}"
          >
          </a-entity>
        </a-entity>
      </a-entity>
    </a-scene>
  </body>

  <style>
    body {
      color: white;
      font-family: sans-serif;
    }
  </style>
</html>
